input_prompt = (f"Here is the full translated text:{translated_text}"
                        f"This is subtitle text, so it may contain labels in square brackets like [Music]."
                        f"Please extract the portion that corresponds as closely as possible to this original line:{line}'"
                        f"Return exactly one line corresponding to this input line. Absolutely do not change anything in"
                        f"the translation, just extract the portion that corresponds to this line. You can break down constituents,"
                        f"do not be shy. This is subtitle text that will then be mapped to time codes, so, each line"
                        f"can be a fragment of any kind. I recommend that you use a bag-of-words approach, forget about"
                        f"sentence structure and just look for a portion in the translation which seems to have the most words"
                        f"corresponding to the original line. Make sure to not output repeated fragments and very long"
                        f"fragments.")
                        

The below prompt produced a very good result at least ones, one demons-med
input_prompt = (f"You are an expert in subtitle formatting and translation mapping. "
                    f"Your task is to take a fully translated subtitle text {translated_text}"
                    f"and find a substring in it "
                    f"that correspond as closely as possible to one original subtitle line ({ln}),"
                    f"ensuring alignment while preserving natural readability."
                    f"The original subtitles may not follow standard sentence structures, "
                    f"and subtitle breaks often occur within phrases, "
                    f"so your output should prioritize that the output is not much longer than the input. "
                    f"Do not include any additional comments or anything else in the output, just the substring.")
                    
                    input_prompt = (f"You are an expert in subtitle formatting and translation mapping. "
                        f"Your task is ONLY to take a fully translated subtitle text {translated_text}"
                        f"and find an ACTUAL substring in it "
                        f"that corresponds to the original subtitle line ({ln})."
                        f"Important: the original subtitles do not follow standard sentence structures, "
                        f"and subtitle breaks often occur within phrases."
                        f"Pay SPECIAL ATTENTION to NOT output very long lines. If the line is long, it means"
                        f"it is best to only take part of it. One heuristic is to look at just words, not"
                        f"the structure of the phrase."
                        f"PRIORITIZE that the substrigs ACTUALLY come from the fully translated text,"
                        f"The text may contain labels such as [Music], which is always its own line."
                        f"ONLY include such labels where they ACTUALLY occur in the translation."
                        f"ABSOLUTELY do NOT include any additional comments or quotation marks in the output, "
                        f"ONLY the ACTUAL substring."
                        f"Here is an example. Suppose the full translation is: '[Music] At around midnight, "
                        f"in a small village, a group of people enter an inn.' Suppose the original subtitle lines are:"
                        f" '[музыка]'; 'В полночь'; 'в небольшой деревне'; 'группа людей входит'; 'в таверну.' The"
                        f"output must be: '[Music]'; 'At around midnight,'; 'in a small village,'; "
                        f"'a group of people enter'; 'an inn.'"
                        f"NOTE: this was only an example. The actual input and output will be different.")
        response = client.chat.completions.create(
                model="gpt-4-turbo",
                temperature=0, # reduce the creativity of the AI model
                messages=[
                    {"role": "system", "content": "You are an expert in subtitle formatting and translation mapping."},
                    {"role": "user", "content": input_prompt}
                ])
